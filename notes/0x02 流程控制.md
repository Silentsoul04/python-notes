#  流程控制

## 1. switch / case

Python 中虽没有提供 `switch/case` 语句，但我们可以使用 `if/elif/else` 语句或字典来模拟 `switch/case` 语句。

```python
def dispatch_if(operator, x, y):
    if operator == 'add':
        return x + y
    elif operator == 'sub':
        return x - y
    elif operator == 'mul':
        return x * y
    elif operator == 'div':
        return x / y
    else:
        return None

# 因为函数在Python中是第一类公民，所以我们可以将函数作为字典的值，
# 因而能够利用字典模拟switch/case语句
def dispatch_dict(operator, x, y):
    return {
        'add': lambda: x + y,
        'sub': lambda: x - y,
        'mul': lambda: x * y,
        'div': lambda: x / y,
    }.get(operator, lambda: None)()


>>> dispatch_if('mul', 2, 8)
16

>>> dispatch_dict('mul', 2, 8)
16

>>> dispatch_if('unknown', 2, 8)
None

>>> dispatch_dict('unknown', 2, 8)
None
```

## 2. if / elif / else

`if` 语句的语法如下：

```
if <条件判断1>:
    <执行1>
elif <条件判断2>:
    <执行2>
elif <条件判断3>:
    <执行3>
else:
    <执行4>
```

`if` 语句会从上往下依次执行 `<条件判断>`，如果某个 `<条件判断>` 的布尔意义为真，则会执行该分支下的语句，并忽略剩余的 `elif/else` 分支。

## 3. while / else

`while` 语句的语法如下：(注意：C/C++ 中的 `while` 语句并没有 `else` 分支)

```
while <条件判断1>:
    <执行1>
else:
	# 可选分支
	# 如果在循环体中没有遇见break语句，则会执行else分支
    <执行2>
```

示例 - 在循环体中没有遇见 `break` 语句时，会执行 `else` 语句

```python
val = True
while val:
    val = False 
    print("while")
else:
    print("else")
"""Out:
while
else
"""
```





示例：

```
number = 23
running = True

while running:
    guess = int(input('Enter an integer : '))

    if guess == number:
        print('Congratulations, you guessed it.')
        # this causes the while loop to stop
        running = False
    elif guess < number:
        print('No, it is a little higher than that.')
    else:
        print('No, it is a little lower than that.')
else:
    print('The while loop is over.')
    # Do anything else you want to do here

print('Done')
```

Output:

```
$ python while.py
Enter an integer : 50
No, it is a little lower than that.
Enter an integer : 22
No, it is a little higher than that.
Enter an integer : 23
Congratulations, you guessed it.
The while loop is over.
Done
```





### for...else

The `for..in` statement is another looping statement which *iterates*遍历 over a sequence of objects i.e. go through each item in a sequence. 

```
names = ['Michael', 'Bob', 'Tracy']
for name in names:
    print(name)
```

Output:

```
Michael
Bob
Tracy
```

Example (save as `for.py`):

```
for i in range(1, 5):
    print(i)
else:
    print('The for loop is over')
```

Output:

```
$ python for.py
1
2
3
4
The for loop is over
```

By default, `range()` takes a step count of 1. If we supply a third number to range, then that becomes the step count. 
For example, range(1,5,2) gives [1,3]. Remember that the range extends up to the second number i.e. it does not include the second number.

Remember that **the `else` part is optional**. When included, it is always executed once after the `for` loop is over unless a break statement is encountered.

Remember that **the `for..in` loop works for any sequence**. Here, we have a list of numbers generated by the built-in `range` function, but in general we can use any kind of sequence of any kind of objects! 我们可以使用任何对象的任何序列。

**Note for C/C++/Java/C# Programmers**

The Python `for` loop is radically彻底 different from the C/C++ `for` loop. C# programmers will note that the `for` loop in Python is similar to the `foreach` loop in C#. Java programmers will note that the same is similar to `for (int i : IntArray)` in Java 1.5.

In C/C++, if you want to write `for (int i = 0; i < 5; i++)`, then in Python you write just `for i in range(0,5)`. As you can see, the `for` loop is simpler, more expressive表现力 and less error prone in Python.

#### 修改正在被迭代的序列

若想在循环体内修改正在被迭代的序列（例如复制序列中选定的项）。
建议先为该序列创建一个副本。
当迭代某个序列时并不会隐式地创建一个副本。
利用切片功能可以很方便的创建副本。

```
>>> for w in words[:]:  # Loop over a slice copy of the entire list.
...     if len(w) > 6:
...         words.insert(0, w)
...
>>> words
['defenestrate', 'cat', 'window', 'defenestrate']
```

#### 引用多个变量

上面的 `for` 循环里，同时引用了两个变量：

```
>>> for x, y in [(1, 1), (2, 4), (3, 9)]:
...     print(x, y)
...
1 1
2 4
3 9
```

### else

- 配合 `loop` 语句使用时，会在没有发生 `break` 的情况下执行。
- 配合 `try` 语句使用时，会在没有发生异常的情况下执行。
- 配合 `if` 语句使用时，会在前面所有条件判断都为假的情况下执行。

## 4. break

`break` 语句用于跳出当前的循环体。如果循环体(`for` 或 `while`)有可选分支 `else`，当通过 `break` 跳出该循环体时，同样会跳过 `else` 分支。

示例 - 持续获取输入内容，如果遇见字符串 `'done'` 则退出：

```python
while True:
    line = input('> ')
    if line == 'done':
        break
    print(line)
else:
    print('else')

print('Done!')
'''Out
$ C:/Python36/python.exe c:/Users/iwhal/Desktop/内置函数/test.py
> done
Done!
'''
```







Example (save as `break.py`):

```
while True:
    s = input('Enter something : ')
    if s == 'quit':
        break
    print('Length of the string is', len(s))
print('Done')
```

Output:

```
$ python break.py
Enter something : Programming is fun
Length of the string is 18
Enter something : When the work is done
Length of the string is 21
Enter something : if you wanna make your work also fun:
Length of the string is 37
Enter something : use Python!
Length of the string is 11
Enter something : quit
Done
```

**How It Works**

> In this program, we repeatedly反复 take the user's input and print the length of each input each time. We are providing提供 a special condition to stop the program by checking if the user input is `'quit'`. We stop the program by *breaking* out of the loop and reach到达repeatedly the end of the program.
>
> The length of the input string can be found out using the built-in `len` function.
>
> Remember that the `break` statement can be used with the `for` loop as well.

### continue

`continue`的作用是提前结束本轮循环，并直接开始下一轮循环。`break` 语句用于在循环过程中直接退出循环。
这两个语句通常都必须配合`if`语句使用。

如果我们想只打印奇数，可以用`continue`语句跳过某些循环：

```
n = 0
while n < 10:
    n = n + 1
    if n % 2 == 0: # 如果n是偶数，执行continue语句
        continue # continue语句会直接继续下一轮循环，后续的print()语句不会执行
    print(n)
```

不要滥用 `break` 和 `continue` 语句。`break` 和`continue`会造成代码执行逻辑分叉过多，容易出错。

### 深入条件控制

More on Conditions

```
if <条件判断1>:
    <执行1>
elif <条件判断2>:
    <执行2>
else:
    <执行3>
```

```
while <条件判断1>:
    <执行1>
else:
    <执行2>
```

`<条件判断>` 在 `while` 和 `if` 中可以是任何运算符，不仅仅是指比较运算符。

 `in` 和`not in` ：用于成员测试。对于字典，应使用 key 进行成员测试。

 `is` 和 `is not` ：test for object identity: `x is y` is true if and only if *x* and *y* are the same object. Object identity is determined using the [`id()`](https://docs.python.org/3/library/functions.html#id) function. `x is not y` yields the inverse truth value. `==` 运算符比较数据结构内部的内容(如两个列表)在结构上的相等性

```
In [7]: c=[1,2]

In [8]: d=[1,2]

In [9]: c is d
Out[9]: False

In [12]: e=c

In [13]: e is c
Out[13]: True
```

比较操作可以被串联在一起使用。
例如： `a < b == c` 测试是否 `a` 小于 `b` 并且 `b` 等于 `c`。

比较操作可以同布尔运算符 `and` / `or` 一起使用，并且比较操作( 或任何其它的布尔表达式 )的结果可以使用 `not` 取反。布尔运算的优先级低于比较运算符；在布尔运算之中，`not` 拥有最高优先级，`or` 的优先级最低，因此 `A and not B or C` 等价于  `(A and (not B)) or C` 。通常括号被用于表达期望的运算顺序。

布尔运算 `and` / `or` 也称作短路运算符 *short-circuit* ：其参数从左向右进行求值，一旦可以确定结果就立刻停止求值。例，如果 `A` 和 `C` 为真而 `B` 为假， `A and B and C` 不会计算表达式 `C` 。

当普通值（非布尔值）被用于布尔运算时，短路计算的结果是最后一个参与计算的参数的值。

可以把比较运算或其它布尔表达式的返回值赋给一个变量，例如:

```
>>> string1, string2, string3 = '', 'Trondheim', 'Hammer Dance'
>>> non_null = string1 or string2 or string3
>>> non_null
'Trondheim'
```

注意，Python 与 C 不同，在表达式内部不能出现出现赋值运算。C 程序员可能会抱怨这一点，但这避免了在 C 程序中遇到的一类共通的问题：当有意使用 `==` 时，却在表达式中错误输入了 `=` 。

### 循环技巧

Looping Techniques

#### items()

> When looping through dictionaries, the key and corresponding value can be retrieved at the same time using the `items()` method.

当通过循环遍历字典时，使用 `items()` 方法可以同时获取 key 和对应的 value。

```
>>> knights = {'gallahad': 'the pure', 'robin': 'the brave'}
>>> for k, v in knights.items():
...     print(k, v)
...
gallahad the pure
robin the brave
```

#### enumerate()

> When looping through a sequence, the position index and corresponding value can be retrieved at the same time using the [`enumerate()`](../library/functions.html#enumerate) function.

当通过循环遍历序列时，索引位置和对应值可以使用  [`enumerate()`](../library/functions.html#enumerate) 函数同时获取。

```
>>> for i, v in enumerate(['tic', 'tac', 'toe']):
...     print(i, v)
...
0 tic
1 tac
2 toe
```

#### zip()

> To loop over two or more sequences at the same time, the entries can be paired with the [`zip()`](../library/functions.html#zip) function.

同时循环两个或更多的序列，可以使用  [`zip()`](../library/functions.html#zip) 对条目进行配对。

```
>>> questions = ['name', 'quest', 'favorite color']
>>> answers = ['lancelot', 'the holy grail', 'blue']
>>> for q, a in zip(questions, answers):
...     print('What is your {0}?  It is {1}.'.format(q, a))
...
What is your name?  It is lancelot.
What is your quest?  It is the holy grail.
What is your favorite color?  It is blue.
```

#### reversed( )

> To loop over a sequence in reverse, first specify the sequence in a forward direction and then call the [`reversed()`](../library/functions.html#reversed) function.

需要逆向循环序列的话，先正向定位序列，然后调用 [`reversed()`](../library/functions.html#reversed) 函数:

```
>>> for i in reversed(range(1, 10, 2)):
...     print(i)
...
9
7
5
3
1
```

#### sorted( )

> To loop over a sequence in sorted order, use the [`sorted()`](../library/functions.html#sorted) function which returns a new sorted list while leaving the source unaltered.

以排序后的顺序循环序列，使用 [`sorted()`](../library/functions.html#sorted) 函数，该函数会返回一个新的经过排序的列表，同时保持源序列不变。

```
>>> basket = ['apple', 'orange', 'apple', 'pear', 'orange', 'banana']
>>> for f in sorted(set(basket)):
...     print(f)
...
apple
banana
orange
pear
```

#### 使用新列表替换原列表

> It is sometimes tempting to change a list while you are looping over it; however, it is often simpler and safer to create a new list instead.

当列表时，有时你会尝试修改一个正在循环的列表；然而，创建一个新列表以替换原列表，是更简单和安全的方法。

```
>>> import math
>>> raw_data = [56.2, float('NaN'), 51.7, 55.3, 52.5, float('NaN'), 47.8]
>>> filtered_data = []
>>> for value in raw_data:
...     if not math.isnan(value):
...         filtered_data.append(value)
...
>>> filtered_data
[56.2, 51.7, 55.3, 52.5, 47.8]

```

## 术语

### 条件语句(conditional statement)

> A statement that controls the flow of execution depending on some condition.

一段根据某个条件决定程序执行流程的语句。

### 条件(condition)

> The boolean expression in a conditional statement that determines which branch runs.

决定哪个分支会被执行的布尔表达式

### 复合语句(compound statement)

> A statement that consists of a header and a body. The header ends with a colon (:). The body is indented relative to the header.

由语句头和语句体组成的语句。语句头以 `:` 结尾，语句体相对语句头缩进。

### 分支(branch)

> One of the alternative sequences of statements in a conditional statement.

条件语句中的选择性语句序列。

### 链式条件(chained conditional)

> A conditional statement with a series of alternative branches.

由一系列替代分支组成的条件语句。

### 嵌套条件语句(nested conditional)

> A conditional statement that appears in one of the branches of another conditional statement.

出现另一个条件语句某个分支中的条件语句。

### 迭代(iteration)

> Repeated execution of a set of statements using either a recursive function call or a loop.

利用递归或者循环的方式来重复执行代一组语句的过程。