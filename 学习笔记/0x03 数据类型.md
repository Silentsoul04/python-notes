# 0x03 数据类型

Data Types

[TOC]

## 1. 数  Numbers

### 整数 int

`int` 没有大小限制，可以是任意大小的正/负整数。

十六进制整数：使用 `0x`  作为前缀 ，`0xff00`

整数与浮点数的混合计算中，整数会被转换为浮点数。

没有 `long` 类型。

注意：某些语言的整数根据其存储长度是有大小限制的，例如 Java 对32位整数的范围限制在 `-2147483648` - `2147483647`。

### 浮点数 float 

`float`  类型没有大小限制。但是当超出一定范围后，会被直接表示为 `inf` 。

科学记数法：用 E 表示10的幂，0.000012可以写成`1.2e-5` 。

整数和浮点数在计算机中采用了不同的存储方式。

浮点数运算可能会产生舍入误差。

### other types of numbers

Python 还支持其它数字类型：

-   `Decimal`  小数
-   `Fraction` 分数
-   Python 内建支持 [复数](https://docs.python.org/3/library/stdtypes.html#typesnumeric) [complex numbers](../library/stdtypes.html#typesnumeric) ，使用后缀 `j` 或 `J` 表示虚数部分（例如，`3+5j`）。

## 2. 字符串 Strings

A string is a *sequence* of *characters*. 

-   没有单独的  `char` 数据类型。 
    一个字符应视为长度为 1 的字符串。


-   字符串是 [不可变的](https://docs.python.org/3/glossary.html#term-immutable) ，不能对字符串本身做出修改。
    因此，赋值给字符串索引的位置会导致错误结果：

    ```
    >>> word[0] = 'J'
      ...
    TypeError: 'str' object does not support item assignment
    >>> word[2:] = 'py'
      ...
    TypeError: 'str' object does not support item assignment
    ```


-   如果需要更改字符串，应该创建一个新的字符串。

    ```
    >>> 'J' + word[1:]
    'Jython'
    >>> word[:2] + 'py'
    'Pypy'
    ```


### 引号

#### 单引号/双引号

单引号和双引号完全相同，没有任何区别。
引号内所有的 space (spaces and tabs) 都照原样保留。 

如果`'`本身也是一个字符，那就可以用`""`括起来，如`"I'm OK"`

#### 三重引号 Triple Quotes

三重引号用于指定多行字符串 - (`"""` or `'''`)。
可在三重引号中自由使用单引号和双引号。例如：

```
'''This is a multi-line string. This is the first line.
This is the second line.
"What's your name?," I asked.
He said "Bond, James Bond."
'''
```
也可在多行字符串 `'''...'''` 前面加上 `r` 使用。

##### 行尾换行符

行尾换行符会被自动包含到字符串中，但是可以在行尾加上 `\` 来避免这个行为。下面的示例： 

```
print("""\
Usage: thingy [OPTIONS]
     -h                        Display this usage message
     -H hostname               Hostname to connect to
""")
```

输出如下（注意，不包括初始换行符）：

```
Usage: thingy [OPTIONS]
     -h                        Display this usage message
     -H hostname               Hostname to connect to
```

### 转义序列

Escape Sequences

`\` 字符用于将非图形化的字符(如 换行符 `\n`, 制表符 `\t` 或 反斜杠 `\` )进行转义。

```
>>> print('I\'m learning\nPython.')
I'm learning
Python.
>>> print('\\\n\\')
\
\
```

如果字符串内部既包含`'`又包含`"`，可以用转义字符 `\` 来标识，比如：(注意有无 `print()` 语句的区别。)

```
>>> 'I\'m \"OK\"!'
'I\'m "OK"!'
>>> print('I\'m \"OK\"!')
I'm "OK"!
```

在行末的一个反斜杠 `\` 表示该字符串在下一行继续，此处不会添加换行符。
例如：

```
"This is the first sentence. \
This is the second sentence."
```

等效于：

```
"This is the first sentence. This is the second sentence."
```

### 原始字符串

Raw String

如果字符串里面有很多字符都需要转义，便会加入很多`\` 。
此时，为了简化操作，Python 允许使用 `r'...'` 表示 `'...'` 内部的字符串默认不转义：

```
>>> print('\\\t\\')
\       \
>>> print(r'\\\t\\')
\\\t\\
```

**注意：正则表达式用户**

当处理正则表达式时通常会使用原始字符串。否则会需要使用很多的反斜杠。例如，反向引用符可以写成 `'\\1'` or `r'\1'`.

### 将值转化为字符串

convert values to strings

 [`repr()`](https://docs.python.org/3/library/functions.html#repr) 或 [`str()`](https://docs.python.org/3/library/stdtypes.html#str) 函数，可将值转换为字符串。

#### repr(obj, /)

Return the canonical标准 string representation of the object.
For many object types, including most builtins, eval(repr(obj)) == obj.

Return a string containing a printable representation of an object. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to [`eval()`](https://docs.python.org/3/library/functions.html#eval), otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances实例 by defining a [`__repr__()`](https://docs.python.org/3/reference/datamodel.html#object.__repr__) method.

```
In [49]: eval(repr('12'))
Out[49]: '12'

In [50]: eval(str('12'))
Out[50]: 12
```

#### \_\_repr\_\_

>   object. `__repr__` (*self*) 
>
>   Called by the [`repr()`](../library/functions.html#repr) built-in function to compute the **“official”** string representation of an object. 
>
>   If at all possible, this should look like a valid Python expression that could be used to recreate an object with the same value (given an appropriate environment). 
>
>   If this is not possible, a string of the form `<...some useful description...>` should be returned. 
>
>   The **return** value must be a string object. 
>
>   If a class defines [`__repr__()`](#object.__repr__) but not [`__str__()`](#object.__str__), then [`__repr__()`](#object.__repr__) is also used when an “informal” string representation of instances of that class is required.
>
>   This is typically used for **debugging**, so it is important that the representation is information-rich and unambiguous清晰.

```
class Student():
    def __init__(self, name):
        self.name = name

    def __repr__(self): # 返回值必须是字符串
        return 'Student object (name = {})'.format(self.name)


stu = Student('Bob')

#通过repr调用
stu_repr = repr(stu)
print(stu_repr)
print()

#print会请求 __str__
print(stu_repr)
```

输出：

```
Student object (name = Bob)

Student object (name = Bob)
```

-   若不定义 `__repr__` 方法：

```
class Student():
    def __init__(self, name):
        self.name = name

#    def __repr__(self):
#        return 'Student object (name = {})'.format(self.name)


stu = Student('Bob')
stu_repr = repr(stu)
print(stu_repr)
print()

#print会请求 __str__
print(stu_repr)
```

输出：

```
<__main__.Student object at 0x000002DE34B2D3C8>

<__main__.Student object at 0x000002DE34B2D3C8>
```

如果 `__str__` 和 `__repr__` 相同，可直接写作 `__repr__ = __str__` 。

```
class Student(object):
    def __init__(self, name):
        self.name = name
    def __str__(self):
        return 'Student object (name=%s)' % self.name
    __repr__ = __str__
```



#### str(object='')

class str(object='')
class str(object=b'', encoding='utf-8', errors='strict')

Return a string version of object. If object is not provided, returns the empty string. Otherwise, the behavior of str() depends on whether encoding or errors is given, as follows.

#### \_\_str_\_

>   `object.` `__str__`(*self*)  
>
>   Called by [`str(object)`](../library/stdtypes.html#str) and the built-in functions [`format()`](../library/functions.html#format) and [`print()`](../library/functions.html#print) to compute the “informal” or nicely printable string representation of an object. The return value must be a [string](../library/stdtypes.html#textseq) object.
>
>   This method differs from [`object.__repr__()`](#object.__repr__) in that there is no expectation期望 that [`__str__()`](#object.__str__) return a valid Python expression: a more convenient or concise representation can be used.
>
>   The default implementation defined by the built-in type [`object`](../library/functions.html#object) calls [`object.__repr__()`](#object.__repr__).

```
class Student():
    def __init__(self, name):
        self.name = name

    def __str__(self):
        return 'Student object (name = {})'.format(self.name)


stu = Student('Bob')
stu_str = str(stu)
print(stu_str)
print()
print(stu_str)
```

输出：

```
Student object (name = Bob)

Student object (name = Bob)
```

如果没有定义 `__str__`

```
class Student():
    def __init__(self, name):
        self.name = name

#    def __str__(self):
#        return 'Student object (name = {})'.format(self.name)


stu = Student('Bob')
stu_str = str(stu)
print(stu_str)
print()
print(stu_str)
```

输出：

```
class Student():
    def __init__(self, name):
        self.name = name

#    def __str__(self):
#        return 'Student object (name = {})'.format(self.name)


stu = Student('Bob')
stu_str = str(stu)
print(stu_str)
print()
print(stu_str)
```



#### repr() vs str()

>   The [`str()`](https://docs.python.org/3/library/stdtypes.html#str) function is meant to return representations of values which are fairly human-readable, while [`repr()`](https://docs.python.org/3/library/functions.html#repr) is meant to generate representations which can be read by the interpreter (or will force a [`SyntaxError`](https://docs.python.org/3/library/exceptions.html#SyntaxError) if there is no equivalent syntax). For objects which don’t have a particular representation for human consumption, [`str()`](https://docs.python.org/3/library/stdtypes.html#str) will return the same value as [`repr()`](https://docs.python.org/3/library/functions.html#repr). Many values, such as numbers or structures like lists and dictionaries, have the same representation using either function. Strings, in particular, have two distinct representations.

 [`str()`](https://docs.python.org/3/library/stdtypes.html#str) 函数意味着返回一个用于易读的表达形式，而 `repr()` 则意味着产生一个可以被解释器读取的形式( 如果没有等效语法，将会强制出现 [`SyntaxError`](https://docs.python.org/3/library/exceptions.html#SyntaxError) 异常 )。对于那些没有适于人类阅读的特定形式的对象， [`str()`](https://docs.python.org/3/library/stdtypes.html#str) 将会返回与 [`repr()`](https://docs.python.org/3/library/functions.html#repr) 相同的值。许多值，如数字；或结构，如列表和字典，使用这两个函数时会给出相同的形式。字符串比较特殊，会给出两种不同的展现形式。

一些示例：

```
>>> s = 'Hello, world.'
>>> str(s)
'Hello, world.'
>>> repr(s)
"'Hello, world.'"
>>> str(1/7)
'0.14285714285714285'
>>> x = 10 * 3.25
>>> y = 200 * 200
>>> s = 'The value of x is ' + repr(x) + ', and y is ' + repr(y) + '...'
>>> print(s)
The value of x is 32.5, and y is 40000...
>>> # The repr() of a string adds string quotes and backslashes 
	# 在repr()中的字符添加引号和反斜线:
... hello = 'hello, world\n'
>>> hellos = repr(hello)
>>> print(hellos)
'hello, world\n'
>>> # 传递给repr()的参数可以是任何 Python对象 
# The argument to repr() may be any Python object:
... repr((x, y, ('spam', 'eggs')))
"(32.5, 40000, ('spam', 'eggs'))"
```

示例，用于计算平方和立方：

```
>>> for x in range(1, 11):
...     print(repr(x).rjust(2), repr(x*x).rjust(3), end=' ')
...     # Note use of 'end' on previous line 
...     print(repr(x*x*x).rjust(4))
...
 1   1    1
 2   4    8
 3   9   27
 4  16   64
 5  25  125
 6  36  216
 7  49  343
 8  64  512
 9  81  729
10 100 1000

>>> for x in range(1, 11):
...     print('{0:2d} {1:3d} {2:4d}'.format(x, x*x, x*x*x))
...
 1   1    1
 2   4    8
 3   9   27
 4  16   64
 5  25  125
 6  36  216
 7  49  343
 8  64  512
 9  81  729
10 100 1000
```

示例中，每列之间的第一个空格有 `print()` 自动添加。`print()` 会自动将两个参数间的逗号替换为空格。

 [`str.rjust()`](https://docs.python.org/3/library/stdtypes.html#str.rjust) 右对齐字符串，同样也可以使用切片 如  `x.ljust(n)[:n]` 
 [`str.ljust()`](https://docs.python.org/3/library/stdtypes.html#str.ljust) 左对齐
 [`str.center()`](https://docs.python.org/3/library/stdtypes.html#str.center)中心对齐
 [`str.zfill()`](https://docs.python.org/3/library/stdtypes.html#str.zfill) 在数值字符串的左侧填充 0
字符串方法会返回一个新的字符串。
因此也可以直接使用切片功能，如：`str.ljust(n)[:n]`

### 格式化串输出

The format method



#### str.format(*args, **kwargs)

关于 [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format) 字符串格式的完整概述，阅读 [Format String Syntax](https://docs.python.org/3/library/string.html#formatstrings)。

##### 位置参数

括号中的数字用于表示  [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format) 中各个对象的位置。

```
>>> print('{0} and {1}'.format('spam', 'eggs'))
spam and eggs
>>> print('{1} and {0}'.format('spam', 'eggs'))
eggs and spam
```

##### 关键字参数

如果在 [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format) 中使用关键字实参，那么通过实参值便可引用相应的值。

```
>>> print('This {food} is {adjective}.'.format(
...       food='spam', adjective='absolutely horrible'))
This spam is absolutely horrible.
```

位置参数和关键字实参可以任意组合：

```
>>> print('The story of {0}, {1}, and {other}.'.format('Bill', 'Manfred',
                                                       other='Georg'))
The story of Bill, Manfred, and Georg.
```

##### 值转换

在进行格式化之前，可对相应的值进行转换:

`'!a'` (使用 [`ascii()`](https://docs.python.org/3/library/functions.html#ascii))

`'!s'` (使用 [`str()`](https://docs.python.org/3/library/stdtypes.html#str)) /  `'!r'` (使用 [`repr()`](https://docs.python.org/3/library/functions.html#repr)) 

```
>>> contents = 'eels'
>>> print('My hovercraft is full of {}.'.format(contents))
My hovercraft is full of eels.
>>> print('My hovercraft is full of {!r}.'.format(contents))
My hovercraft is full of 'eels'.
```

##### 格式说明符

field name 后 `':'`  + 格式说明符的表述方式是可选的。
这种方式允许对值的格式化进行更好的控制。
下面的示例将 Pi 保留到小数点后三位小数。

```
>>> import math
>>> print('The value of PI is approximately {0:.3f}.'.format(math.pi))
The value of PI is approximately 3.142.
```

可向 `':'` 后方传递一个整型，这将限定该字段的最小字符宽度。

```
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 7678}
>>> for name, phone in table.items():
...     print('{0:10} ==> {1:10d}'.format(name, phone))
...
Jack       ==>       4098
Dcab       ==>       7678
Sjoerd     ==>       4127
```

也可以换为自己需要的符号：

```
# fill with underscores (_) with the text centered
# (^) to 11 width '___hello___'
In [2]: print('{0:_^11}'.format('hello'))
___hello___
```

如果遇到一个很长的格式化字符串，但是由于某种原因，不能将其分割。
这时通过名称来引用相应的变量，会是更好的选择。
最简单的做法是传递一个字典，并且使用方括号 `'[]'` 来访问 keys。

```
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
>>> print('Jack: {0[Jack]:d}; Sjoerd: {0[Sjoerd]:d}; '
...       'Dcab: {0[Dcab]:d}'.format(table))
Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

 也可以通过使用 `**` 标记符传递关键字实参的方式来实现。

```
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
>>> print('Jack: {Jack:d}; Sjoerd: {Sjoerd:d}; Dcab: {Dcab:d}'.format(**table))
Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

下面这段引用出自 python tutorial，但是我暂时没有理解其中的意思。

>   This is particularly useful in combination with the built-in function [`vars()`](https://docs.python.org/3/library/functions.html#vars), which returns a dictionary containing all local variables.

结合内置函数 [`vars()`](https://docs.python.org/3/library/functions.html#vars) 会特别有用，这会返回一个包含所有本地变量的字典。




Python 将 specification 的位置替换为各自的变量值：

```

# keyword-based 'Swaroop wrote A Byte of Python'
print('{name} wrote {book}'.format(name='Swaroop', book='A Byte of Python'))
```

Output:

```
0.333
___hello___
Swaroop wrote A Byte of Python

```

#### format()函数



#### Template class

[`string`](https://docs.python.org/3/library/string.html#module-string) 模块包含了模板类( [`Template`](https://docs.python.org/3/library/string.html#string.Template) class)，可以提供另一种在字符串中替换值的方式。

### 操作字符串的方法

-   [String Methods](https://docs.python.org/3/library/stdtypes.html#string-methods) 

    Strings support a large number of methods for basic transformations and searching. 
    字符串支持大量的基本转换和搜索方法。

Python 中的字符串都是 `str` 类的对象。
此处演示`str` 类中的的一些方法。
完整方法列表，可查看 `help(str)` 。

Example (save as `ds_str_methods.py`):

```python
# This is a string object
name = 'Swaroop'

if name.startswith('Swa'):
    print('Yes, the string starts with "Swa"')

if 'a' in name:
    print('Yes, it contains the string "a"')
#不存在，返回-1。在if语句中-1也为真，0为假
if name.find('war') != -1:
    print('Yes, it contains the string "war"')

delimiter = '_*_'
mylist = ['Brazil', 'Russia', 'India', 'China']
print(delimiter.join(mylist))
```

Output:

```python
$ python ds_str_methods.py
Yes, the string starts with "Swa"
Yes, it contains the string "a"
Yes, it contains the string "war"
Brazil_*_Russia_*_India_*_China
```

-   `startswith` 方法被用于检测原字符串是否以给定的字符串开头。
-   `in` 操作符用于检测给定字符串是否是当前字符串的一部分。
-   `find` 方法用于定位给定字符串在原字符串中的位子，如果没有找到子字符串 `find` 返回 -1。
-   `str` 类拥有一个优雅的`join`方法，该方法将一个字符串序列项作为另序列中各个项目之间的分隔符，从该字符串中生成并返回一个更大的字符串。

### 字符串运算符

1.  `+`  表示连接两个字符串； `*` 表示重复某字符串。
    可用于操作变量。

```
>>> # 3 times 'un', followed by 'ium'
>>> 3 * 'un' + 'ium'
'unununium'
>>> prefix + 'thon'
'Python'
```

2.  彼此相邻的字符串字面量，会自动连接在一起：

    注意：该方法只适用于字面量，不能包含表达式和变量。

```
>>> 'Py' 'thon'
'Python'

>>> prefix = 'Py'
>>> prefix 'thon'  # can't concatenate a variable and a string literal
  ...
SyntaxError: invalid syntax
>>> ('un' * 3) 'ium'
  ...
SyntaxError: invalid syntax
```

	当想要断开很长的字符串时，此功能特别有用：

```
>>> text = ('Put several strings within parentheses '
...         'to have them joined together.')
>>> text
'Put several strings within parentheses to have them joined together.'
```

3. 使用比较运算符来比较两个字符串时，会使用 ASCII 顺序来比较对应位置的字符。字符串的长度不作为判定依据。

### 索引

字符串可以被索引（下标），索引可以是负数。复索引需要从右侧开始计数。
当索引为负值时，Python 会将这个值和字符串的长度相加，从而得出一个正索引值。
因此，负索引的绝对值不能小于字符串的长度。
注意，因为 -0 和 0 是相同的，所以负索引从 -1 开始。

```
 +---+---+---+---+---+---+
 | P | y | t | h | o | n |
 +---+---+---+---+---+---+
   0   1   2   3   4   5   6
   -6  -5  -4  -3  -2  -1
```

```
>>> word = 'Python'
>>> word[0]  # character in position 0
'P'
>>> word[5]  # character in position 5
'n'
```

### 切片

索引用于获取单个字符，切片可获取子字符串：

含有 n 个字符的字符串的右边的最后一个字符的索引是 n-1，例如：

```
 +---+---+---+---+---+---+
 | P | y | t | h | o | n |
 +---+---+---+---+---+---+
   0   1   2   3   4   5   6
   -6  -5  -4  -3  -2  -1
```

```
>>> word = 'Python'
>>> word[0:2]  # characters from position 0 (included) to 2 (excluded)
'Py'
>>> word[2:5]  # characters from position 2 (included) to 5 (excluded)
'tho'
```

注意：切片包含起始的字符，不包含末尾的字符。
这使得  `s[:i] + s[i:]` 始终等于 `s` 。
对于非负索引，如果上下都在边界内，切片长度就是两个索引之差。
例如，`word[1:3]` 是 2 。

```
>>> word[:2] + word[2:]
'Python'
>>> word[:4] + word[4:]
'Python'
```

切片操作的默认值：
第一个索引值被省略时，会将其设为默认值 0；
第二个索引值被省略时，会默认将其设为要切片的字符串的大小。

```
>>> word[:2]   # character from the beginning to position 2 (excluded)
'Py'
>>> word[4:]   # characters from position 4 (included) to the end
'on'
>>> word[-2:]  # characters from the second-last (included) to the end
'on'
```

试图使用超出范围的索引值会导致错误结果:

```
>>> word[42]  # the word only has 6 characters
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
IndexError: string index out of range
```

超出范围的切片索引会被自动地处理：
一个过大的索引值(即下标值大于字符串实际长度)将被字符串实际长度所代替；
当上边界比下边界大时(即切片左值大于右值)就返回空字符串

```
>>> word[4:42]
'on'
>>> word[42:]
''
```

反转字符串

```
In [10]: word[::-1]
Out[10]: 'nohtyP'
```

### len( )

内置函数 [`len()`](../library/functions.html#len) 返回字符串长度:

```
>>> s = 'supercalifragilisticexpialidocious'
>>> len(s)
34
```

## 3. 布尔值

布尔值和布尔代数的表示完全一致，一个布尔值只有`True`、`False`两种值（注意大小写）。

```
>>> True
True
>>> False
False
>>> 3 > 2
True
>>> 3 > 5
False
```

`True` 表示整数 1，`False` 表示整数 0。 

```
>>> int(True)
1
>>> int(False)
0
```

每个对象天生具有 布尔True或False值。
任何非零整数值都为真，任意非零的长度为真。
**注意** ： 负数 的布尔值也是 `True` 。只有 0 是 `False`.

下列对象的布尔值是 `False`：

-   `None`
-   `False` (布尔类型)
-   所有的值为零的数： 0(整型)/ 0.0(浮点型) /0.0+0.0j(复数)
-   `""`(空字符串)，空序列为假
-   `[ ] ` (空列表)
-   `() ` (空元组)
-   `{} ` (空字典)



### 布尔运算

| 运算符  | 逻辑表达式   | 描述                                       | 实例 a=10,b=20          |
| ---- | ------- | ---------------------------------------- | --------------------- |
| and  | x and y | 布尔"与" - 如果 x 为 False，x and y 返回 False，否则它返回 y 的计算值。 | (a and b) 返回 20。      |
| or   | x or y  | 布尔"或" - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。 | (a or b) 返回 10。       |
| not  | not x   | 布尔"非" - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。 | not(a and b) 返回 False |


## 4. 空值

空值是Python里一个特殊的值，用 `None` 表示。
`None` 不能理解为 `0`，因为 `0` 是有意义的，而 `None` 是一个特殊的空值。

返回 `None` 的时候Python的交互式命令行不显示结果。

## 5. 数据类型转换

内置函数包括用于数据类型转换函数，比如 `int()` 函数可以把其他数据类型转换为整数：

```
>>> int('123')
123
>>> int(12.34)
12

>>> float('12.34')
12.34

>>> str(1.23)
'1.23'
>>> str(100)
'100'

>>> bool(1)
True
>>> bool('')
False

>>> hex(255) #将一个整数转换成十六进制表示的字符串
'0xff'
```
